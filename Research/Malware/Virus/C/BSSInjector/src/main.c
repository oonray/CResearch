#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <strings.h>
#include "headder/colors.h"
#include "headder/dbg.h"

struct ELFHeadderData{
		char *magic;	
		int magic_o;
		
		uint8_t *class;
		int class_o;
		
		uint32_t *version;
		int version_o;

		uint32_t *entry32;
		uint64_t *entry64;
		int entry_o;

		int mod64;
};

struct ELFHeadderData data = {.magic_o=0x0, .class_o = 0x4, .version_o = 0x14, .entry_o=0x18, .mod64=0xC};

int is_x64(char *fname){
	    data.class = malloc(sizeof(uint8_t));
        check(data.class,"Could not allocate!");

		FILE *f = fopen(fname, "rb");
		check(f,"File not found");

		fseek(f,data.class_o,SEEK_SET);
		fread(data.class,1,1,f);
		return (int)*data.class == 2? 1:0;
		error:
				return -1;
}


int is_elf(char *fname){
		data.magic = malloc(sizeof(uint32_t));
		check(data.magic,"Could not Allocate!");

		FILE *f = fopen(fname, "rb");
		check(f,"Could not open file");

		fseek(f,data.magic_o,SEEK_SET);
		fread(data.magic,4,1,f);

		return strcmp(data.magic,"ELF")?1:0;
		error:
		     return -1;
}

int get_headder(char *fname){
		int size = is_x64(fname) == 1?52:64; 
		FILE *f = fopen(fname,"rb");
		check(f,"Could not open file");
	
		uint8_t *file_headder = malloc(size);
		check(file_headder,"Could not Allocate!");
		
			
		error:
				return -1;
}

int main(int argc,char *argv[]){
		printf("Is %s x64? %s\n",argv[0],is_x64("/bin/ls")?"Yes":"No");
		printf("Is %s ELF? %s\n",argv[0],is_elf("/bin/ls")?"Yes":"No");
		get_headder("/bin/ls");
}
